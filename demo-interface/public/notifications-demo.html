<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Demo - Sistema de Notifica√ß√µes - Nossa Grana</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <div class="logo-icon">NG</div>
                <div class="logo-text">Nossa Grana</div>
            </div>
            
            <nav>
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="dashboard" class="nav-link">
                            <span class="nav-icon">üìä</span>
                            Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="alerts" class="nav-link">
                            <span class="nav-icon">üö®</span>
                            Alertas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="notifications-demo" class="nav-link active">
                            <span class="nav-icon">üîî</span>
                            Demo Notifica√ß√µes
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="sidebar-footer">
                <button class="logout-btn" onclick="logout()">
                    <span>üö™</span>
                    Sair
                </button>
            </div>
        </aside>

        <!-- Conte√∫do Principal -->
        <main class="main-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">üîî Demonstra√ß√£o do Sistema de Notifica√ß√µes</h1>
                    <p class="page-subtitle">Veja como funciona o sistema inteligente de alertas financeiros</p>
                </div>
                <div class="header-actions">
                    <button class="btn btn-secondary" onclick="resetDemo()">
                        <span class="btn-icon">üîÑ</span>
                        Reiniciar Demo
                    </button>
                    <div class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">
                        <span class="theme-icon light">‚òÄÔ∏è</span>
                        <div class="theme-toggle-switch"></div>
                        <span class="theme-icon dark">üåô</span>
                    </div>
                </div>
            </div>

            <!-- Painel de Controle da Demo -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">üéÆ Controles da Demonstra√ß√£o</h3>
                </div>
                <div class="card-content">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <button class="btn btn-warning" onclick="simulateOverBudget()">
                            üö® Simular Or√ßamento Excedido
                        </button>
                        <button class="btn btn-info" onclick="simulateNearLimit()">
                            ‚ö†Ô∏è Simular Pr√≥ximo do Limite
                        </button>
                        <button class="btn btn-primary" onclick="simulateProjection()">
                            üìä Simular Proje√ß√£o de Excesso
                        </button>
                        <button class="btn btn-success" onclick="simulateGoodNews()">
                            ‚úÖ Simular Boa Not√≠cia
                        </button>
                    </div>
                </div>
            </div>

            <!-- Notifica√ß√µes em Tempo Real -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3 class="card-title">üîî Notifica√ß√µes em Tempo Real</h3>
                    <div class="notification-counter">
                        <span id="notification-count">0</span> notifica√ß√µes ativas
                    </div>
                </div>
                <div class="card-content">
                    <div id="notifications-container" class="notifications-list">
                        <div class="empty-state">
                            <div class="empty-state-icon">üîï</div>
                            <p>Nenhuma notifica√ß√£o ativa</p>
                            <p class="text-muted">Use os controles acima para simular alertas</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Simulador de Or√ßamento -->
            <div class="cards-grid">
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üí∞ Simulador de Gastos</h3>
                    </div>
                    <div class="card-content">
                        <div class="budget-simulator">
                            <div class="form-group">
                                <label class="form-label">Categoria</label>
                                <select id="category-select" class="form-select">
                                    <option value="alimentacao">üçΩÔ∏è Alimenta√ß√£o</option>
                                    <option value="transporte">üöó Transporte</option>
                                    <option value="lazer">üéÆ Lazer</option>
                                    <option value="saude">üè• Sa√∫de</option>
                                    <option value="educacao">üìö Educa√ß√£o</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Valor do Gasto</label>
                                <input type="number" id="expense-amount" class="form-input" placeholder="R$ 0,00" step="0.01">
                            </div>
                            <button class="btn btn-primary" onclick="addExpense()">
                                ‚ûï Adicionar Gasto
                            </button>
                        </div>

                        <div class="budget-status mt-4">
                            <h4>Status dos Or√ßamentos</h4>
                            <div id="budget-bars"></div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">üìä Estat√≠sticas da Demo</h3>
                    </div>
                    <div class="card-content">
                        <div class="demo-stats">
                            <div class="stat-item">
                                <div class="stat-value" id="total-notifications">0</div>
                                <div class="stat-label">Total de Notifica√ß√µes</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="critical-count">0</div>
                                <div class="stat-label">Cr√≠ticas</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="warning-count">0</div>
                                <div class="stat-label">Avisos</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="info-count">0</div>
                                <div class="stat-label">Informa√ß√µes</div>
                            </div>
                        </div>

                        <div class="mt-4">
                            <h5>Tipos de Alertas Demonstrados</h5>
                            <ul class="alert-types-list">
                                <li>üö® Or√ßamento Excedido (>100%)</li>
                                <li>‚ö†Ô∏è Pr√≥ximo do Limite (80-100%)</li>
                                <li>üìä Proje√ß√£o de Excesso</li>
                                <li>üìà Tend√™ncia Preocupante</li>
                                <li>‚úÖ Metas Atingidas</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Toast Container -->
            <div id="toast-container"></div>
        </main>
    </div>

    <script src="js/theme.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script>
        // Estado da demonstra√ß√£o
        let demoState = {
            notifications: [],
            budgets: {
                alimentacao: { limit: 800, spent: 0, name: 'üçΩÔ∏è Alimenta√ß√£o' },
                transporte: { limit: 400, spent: 0, name: 'üöó Transporte' },
                lazer: { limit: 300, spent: 0, name: 'üéÆ Lazer' },
                saude: { limit: 500, spent: 0, name: 'üè• Sa√∫de' },
                educacao: { limit: 200, spent: 0, name: 'üìö Educa√ß√£o' }
            },
            stats: {
                total: 0,
                critical: 0,
                warning: 0,
                info: 0
            }
        };

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            const token = localStorage.getItem('access_token');
            if (!token) {
                window.location.href = '';
                return;
            }

            initializeDemo();
        });

        // Inicializar demonstra√ß√£o
        function initializeDemo() {
            updateBudgetBars();
            updateStats();
            showWelcomeMessage();
        }

        // Mostrar mensagem de boas-vindas
        function showWelcomeMessage() {
            setTimeout(() => {
                addNotification({
                    type: 'info',
                    title: 'Bem-vindo √† Demonstra√ß√£o!',
                    message: 'Use os controles acima para simular diferentes tipos de alertas financeiros.',
                    category: 'sistema',
                    autoClose: false
                });
            }, 1000);
        }

        // Simular or√ßamento excedido
        function simulateOverBudget() {
            const categories = Object.keys(demoState.budgets);
            const category = categories[Math.floor(Math.random() * categories.length)];
            const budget = demoState.budgets[category];
            
            // For√ßar excesso
            budget.spent = budget.limit * 1.2;
            
            addNotification({
                type: 'critical',
                title: 'Or√ßamento Excedido!',
                message: `${budget.name}: Voc√™ gastou R$ ${budget.spent.toFixed(2)} de R$ ${budget.limit.toFixed(2)} (${((budget.spent/budget.limit)*100).toFixed(1)}%)`,
                category: category,
                actions: [
                    { text: 'Ver Detalhes', action: () => showBudgetDetails(category) },
                    { text: 'Ajustar Or√ßamento', action: () => adjustBudget(category) }
                ]
            });
            
            updateBudgetBars();
            showToast('Simula√ß√£o: Or√ßamento excedido!', 'error');
        }

        // Simular pr√≥ximo do limite
        function simulateNearLimit() {
            const categories = Object.keys(demoState.budgets);
            const category = categories[Math.floor(Math.random() * categories.length)];
            const budget = demoState.budgets[category];
            
            // For√ßar 85-95% do limite
            budget.spent = budget.limit * (0.85 + Math.random() * 0.1);
            
            addNotification({
                type: 'warning',
                title: 'Pr√≥ximo do Limite',
                message: `${budget.name}: Voc√™ j√° gastou ${((budget.spent/budget.limit)*100).toFixed(1)}% do or√ßamento mensal`,
                category: category,
                actions: [
                    { text: 'Monitorar', action: () => monitorCategory(category) }
                ]
            });
            
            updateBudgetBars();
            showToast('Simula√ß√£o: Pr√≥ximo do limite!', 'warning');
        }

        // Simular proje√ß√£o de excesso
        function simulateProjection() {
            const categories = Object.keys(demoState.budgets);
            const category = categories[Math.floor(Math.random() * categories.length)];
            const budget = demoState.budgets[category];
            
            const currentDay = new Date().getDate();
            const daysInMonth = new Date(new Date().getFullYear(), new Date().getMonth() + 1, 0).getDate();
            const projectedSpent = (budget.spent / currentDay) * daysInMonth;
            
            addNotification({
                type: 'warning',
                title: 'Proje√ß√£o de Excesso',
                message: `${budget.name}: Com o ritmo atual, voc√™ pode gastar R$ ${projectedSpent.toFixed(2)} at√© o fim do m√™s (${((projectedSpent/budget.limit)*100).toFixed(1)}% do or√ßamento)`,
                category: category,
                actions: [
                    { text: 'Ver Proje√ß√£o', action: () => showProjection(category) }
                ]
            });
            
            showToast('Simula√ß√£o: Proje√ß√£o de excesso!', 'info');
        }

        // Simular boa not√≠cia
        function simulateGoodNews() {
            const messages = [
                'Parab√©ns! Voc√™ est√° 15% abaixo do or√ßamento de Alimenta√ß√£o este m√™s!',
                '√ìtimo controle! Seus gastos com Transporte est√£o 20% menores que o m√™s passado.',
                'Meta atingida! Voc√™ conseguiu economizar R$ 150,00 este m√™s.',
                'Excelente! Voc√™ n√£o teve gastos extras com Lazer nas √∫ltimas 2 semanas.'
            ];
            
            const message = messages[Math.floor(Math.random() * messages.length)];
            
            addNotification({
                type: 'success',
                title: 'Boa Not√≠cia! üéâ',
                message: message,
                category: 'economia',
                autoClose: true
            });
            
            showToast('Simula√ß√£o: Boa not√≠cia!', 'success');
        }

        // Adicionar gasto
        function addExpense() {
            const category = document.getElementById('category-select').value;
            const amount = parseFloat(document.getElementById('expense-amount').value);
            
            if (!amount || amount <= 0) {
                showToast('Digite um valor v√°lido!', 'error');
                return;
            }
            
            const budget = demoState.budgets[category];
            budget.spent += amount;
            
            // Verificar se precisa gerar alerta
            const percentage = (budget.spent / budget.limit) * 100;
            
            if (percentage >= 100) {
                addNotification({
                    type: 'critical',
                    title: 'Or√ßamento Excedido!',
                    message: `${budget.name}: R$ ${budget.spent.toFixed(2)} / R$ ${budget.limit.toFixed(2)} (${percentage.toFixed(1)}%)`,
                    category: category
                });
            } else if (percentage >= 80) {
                addNotification({
                    type: 'warning',
                    title: 'Aten√ß√£o ao Or√ßamento',
                    message: `${budget.name}: ${percentage.toFixed(1)}% do or√ßamento utilizado`,
                    category: category
                });
            }
            
            updateBudgetBars();
            document.getElementById('expense-amount').value = '';
            showToast(`Gasto de R$ ${amount.toFixed(2)} adicionado!`, 'success');
        }

        // Adicionar notifica√ß√£o
        function addNotification(notification) {
            notification.id = Date.now() + Math.random();
            notification.timestamp = new Date();
            notification.autoClose = notification.autoClose !== false;
            
            demoState.notifications.unshift(notification);
            
            // Atualizar estat√≠sticas
            demoState.stats.total++;
            if (notification.type === 'critical') demoState.stats.critical++;
            else if (notification.type === 'warning') demoState.stats.warning++;
            else demoState.stats.info++;
            
            updateNotificationsDisplay();
            updateStats();
            
            // Auto-remover ap√≥s 10 segundos se configurado
            if (notification.autoClose) {
                setTimeout(() => {
                    removeNotification(notification.id);
                }, 10000);
            }
        }

        // Atualizar exibi√ß√£o de notifica√ß√µes
        function updateNotificationsDisplay() {
            const container = document.getElementById('notifications-container');
            const count = document.getElementById('notification-count');
            
            count.textContent = demoState.notifications.length;
            
            if (demoState.notifications.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üîï</div>
                        <p>Nenhuma notifica√ß√£o ativa</p>
                        <p class="text-muted">Use os controles acima para simular alertas</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            demoState.notifications.forEach(notification => {
                const typeConfig = getNotificationTypeConfig(notification.type);
                
                html += `
                    <div class="notification-item ${notification.type}" data-id="${notification.id}">
                        <div class="notification-header">
                            <div class="notification-icon">${typeConfig.icon}</div>
                            <div class="notification-title">${notification.title}</div>
                            <div class="notification-time">${formatTime(notification.timestamp)}</div>
                            <button class="notification-close" onclick="removeNotification(${notification.id})">√ó</button>
                        </div>
                        <div class="notification-message">${notification.message}</div>
                        ${notification.actions ? `
                            <div class="notification-actions">
                                ${notification.actions.map(action => `
                                    <button class="btn btn-sm btn-outline" onclick="handleNotificationAction(${notification.id}, '${action.text}')">${action.text}</button>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Configura√ß√£o de tipos de notifica√ß√£o
        function getNotificationTypeConfig(type) {
            const configs = {
                critical: { icon: 'üö®', color: 'var(--error-color)' },
                warning: { icon: '‚ö†Ô∏è', color: 'var(--warning-color)' },
                info: { icon: '‚ÑπÔ∏è', color: 'var(--info-color)' },
                success: { icon: '‚úÖ', color: 'var(--success-color)' }
            };
            return configs[type] || configs.info;
        }

        // Remover notifica√ß√£o
        function removeNotification(id) {
            const index = demoState.notifications.findIndex(n => n.id === id);
            if (index !== -1) {
                const notification = demoState.notifications[index];
                demoState.notifications.splice(index, 1);
                
                // Atualizar estat√≠sticas
                demoState.stats.total--;
                if (notification.type === 'critical') demoState.stats.critical--;
                else if (notification.type === 'warning') demoState.stats.warning--;
                else demoState.stats.info--;
                
                updateNotificationsDisplay();
                updateStats();
            }
        }

        // Atualizar barras de or√ßamento
        function updateBudgetBars() {
            const container = document.getElementById('budget-bars');
            let html = '';
            
            Object.entries(demoState.budgets).forEach(([key, budget]) => {
                const percentage = Math.min((budget.spent / budget.limit) * 100, 100);
                const overBudget = budget.spent > budget.limit;
                const nearLimit = percentage >= 80;
                
                let barClass = 'success';
                if (overBudget) barClass = 'error';
                else if (nearLimit) barClass = 'warning';
                
                html += `
                    <div class="budget-bar-item">
                        <div class="budget-bar-header">
                            <span>${budget.name}</span>
                            <span>R$ ${budget.spent.toFixed(2)} / R$ ${budget.limit.toFixed(2)}</span>
                        </div>
                        <div class="budget-bar">
                            <div class="budget-bar-fill ${barClass}" style="width: ${percentage}%"></div>
                        </div>
                        <div class="budget-bar-percentage">${percentage.toFixed(1)}%</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            document.getElementById('total-notifications').textContent = demoState.stats.total;
            document.getElementById('critical-count').textContent = demoState.stats.critical;
            document.getElementById('warning-count').textContent = demoState.stats.warning;
            document.getElementById('info-count').textContent = demoState.stats.info;
        }

        // Reiniciar demonstra√ß√£o
        function resetDemo() {
            demoState.notifications = [];
            demoState.stats = { total: 0, critical: 0, warning: 0, info: 0 };
            
            Object.keys(demoState.budgets).forEach(key => {
                demoState.budgets[key].spent = 0;
            });
            
            updateNotificationsDisplay();
            updateBudgetBars();
            updateStats();
            
            showToast('Demonstra√ß√£o reiniciada!', 'success');
            
            setTimeout(() => {
                showWelcomeMessage();
            }, 1000);
        }

        // Fun√ß√µes auxiliares
        function formatTime(date) {
            return date.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
        }

        function showToast(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            
            const container = document.getElementById('toast-container');
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 100);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    container.removeChild(toast);
                }, 300);
            }, 3000);
        }

        // A√ß√µes das notifica√ß√µes (simuladas)
        function handleNotificationAction(id, action) {
            showToast(`A√ß√£o "${action}" executada!`, 'info');
            removeNotification(id);
        }

        function showBudgetDetails(category) {
            showToast(`Exibindo detalhes de ${demoState.budgets[category].name}`, 'info');
        }

        function adjustBudget(category) {
            showToast(`Ajustando or√ßamento de ${demoState.budgets[category].name}`, 'info');
        }

        function monitorCategory(category) {
            showToast(`Monitorando ${demoState.budgets[category].name}`, 'info');
        }

        function showProjection(category) {
            showToast(`Exibindo proje√ß√£o de ${demoState.budgets[category].name}`, 'info');
        }
    </script>

    <style>
        /* Estilos espec√≠ficos da demonstra√ß√£o */
        .notifications-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .notification-item {
            background: var(--bg-secondary);
            border-radius: var(--border-radius);
            padding: 1rem;
            margin-bottom: 0.5rem;
            border-left: 4px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .notification-item.critical {
            border-left-color: var(--error-color);
            background: rgba(var(--error-color-rgb), 0.05);
        }

        .notification-item.warning {
            border-left-color: var(--warning-color);
            background: rgba(var(--warning-color-rgb), 0.05);
        }

        .notification-item.info {
            border-left-color: var(--info-color);
            background: rgba(var(--info-color-rgb), 0.05);
        }

        .notification-item.success {
            border-left-color: var(--success-color);
            background: rgba(var(--success-color-rgb), 0.05);
        }

        .notification-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification-title {
            font-weight: 600;
            flex: 1;
        }

        .notification-time {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .notification-close {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: var(--text-secondary);
            padding: 0;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-message {
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .notification-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.75rem;
        }

        .notification-counter {
            background: var(--primary-color);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .budget-simulator {
            display: grid;
            gap: 1rem;
        }

        .budget-bar-item {
            margin-bottom: 1rem;
        }

        .budget-bar-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .budget-bar {
            height: 8px;
            background: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 0.25rem;
        }

        .budget-bar-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .budget-bar-fill.success {
            background: var(--success-color);
        }

        .budget-bar-fill.warning {
            background: var(--warning-color);
        }

        .budget-bar-fill.error {
            background: var(--error-color);
        }

        .budget-bar-percentage {
            text-align: right;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .demo-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: var(--border-radius);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.875rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }

        .alert-types-list {
            list-style: none;
            padding: 0;
        }

        .alert-types-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .alert-types-list li:last-child {
            border-bottom: none;
        }

        /* Toast notifications */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
        }

        .toast {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 0.5rem;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.3s ease;
            border-left: 4px solid var(--info-color);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.toast-success {
            border-left-color: var(--success-color);
        }

        .toast.toast-error {
            border-left-color: var(--error-color);
        }

        .toast.toast-warning {
            border-left-color: var(--warning-color);
        }
    </style>
</body>
</html>